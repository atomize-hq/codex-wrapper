# Codex CLI Parity PR Body Template (for `automation/codex-cli-<version>` PRs)

@codex

## Goal

Bring the Rust wrapper (`crates/codex`) into parity with upstream `codex` **rust-v0.92.0** by using the generated parity artifacts in `cli_manifests/codex/`.

This PR already contains:
- pinned upstream release assets (`cli_manifests/codex/artifacts.lock.json`)
- upstream CLI snapshots (`cli_manifests/codex/snapshots/0.92.0/**`)
- deterministic coverage reports (work queue) (`cli_manifests/codex/reports/0.92.0/**`)
- version metadata (`cli_manifests/codex/versions/0.92.0.json`)

Your job is to use those outputs to implement/waive wrapper support until the report no longer contains uncovered surfaces for the required target (and, when union is complete, for all expected targets).

## Where To Look (Source Of Truth)

- Upstream union snapshot: `cli_manifests/codex/snapshots/0.92.0/union.json`
- Coverage work queue: `cli_manifests/codex/reports/0.92.0/coverage.any.json`
- Per-target work queue(s): `cli_manifests/codex/reports/0.92.0/coverage.<target_triple>.json`
- Wrapper coverage manifest (generated): `cli_manifests/codex/wrapper_coverage.json`
- Wrapper coverage source-of-truth (edit this, not the JSON): `crates/codex/src/wrapper_coverage_manifest.rs`
- Wrapper coverage scenario catalog (normative): `docs/specs/codex-wrapper-coverage-scenarios-v1.md`
- Wrapper coverage generator contract (normative): `docs/specs/codex-wrapper-coverage-generator-contract.md`
- Validator contract: `cli_manifests/codex/VALIDATOR_SPEC.md`
- Rules + policy: `cli_manifests/codex/RULES.json`
- Agent runbook: `cli_manifests/codex/CI_AGENT_RUNBOOK.md`

Baseline (previously supported):
- Latest validated version pointer: `cli_manifests/codex/latest_validated.txt`
- Baseline union snapshot: `cli_manifests/codex/snapshots/<latest_validated>/union.json`
- Baseline report: `cli_manifests/codex/reports/<latest_validated>/coverage.any.json`

Pointer policy:
- Do not change `cli_manifests/codex/min_supported.txt` unless maintainers explicitly request a policy bump.

## What To Do (Operational Steps)

1) **Triage the delta for 0.92.0**
- Open `cli_manifests/codex/reports/0.92.0/coverage.any.json`
- Work the lists in this order:
  - `deltas.missing_commands`
  - `deltas.missing_flags`
  - `deltas.missing_args`
  - `deltas.unsupported` (if present)
  - `deltas.passthrough_candidates` (if present; “nice-to-have explicit promotions”)

2) **Classify each missing/unsupported surface**
For each missing unit (command/flag/arg), choose exactly one:
- **Implement support** in `crates/codex` and mark it `explicit` in `crates/codex/src/wrapper_coverage_manifest.rs`, or
- If only safely doable via CLI forwarding, mark it `passthrough`, or
- If we intentionally will not support it, mark it `intentionally_unsupported` **with a non-empty `note`** (required by validator).

Guardrails:
- Do **not** hand-edit `cli_manifests/codex/wrapper_coverage.json` (it is generated).
- Do **not** modify snapshots/reports by hand; re-run generators instead.

3) **Compare 0.92.0 to the current supported baseline**
- Read baseline version: `BASELINE="$(cat cli_manifests/codex/latest_validated.txt)"`
- Determine what’s new/removed at the CLI surface layer by diffing the two union snapshots:
  - New surfaces = present in `snapshots/0.92.0/union.json` but not present in `snapshots/$BASELINE/union.json`
  - Removed surfaces = present in baseline union but not present in 0.92.0 union
  - Treat “new surfaces” as high priority to assess for wrapper support.
  - Treat “removed surfaces” as potential wrapper deprecations (or leave as wrapper-only if still needed).

4) **Regenerate + validate after changes**
Run these from repo root:
- `cargo run -p xtask -- codex-wrapper-coverage --out cli_manifests/codex/wrapper_coverage.json`
- `cargo run -p xtask -- codex-report --version 0.92.0 --root cli_manifests/codex`
- `cargo run -p xtask -- codex-version-metadata --version 0.92.0 --status reported --root cli_manifests/codex`
- `cargo run -p xtask -- codex-validate --root cli_manifests/codex`

Then run wrapper tests (Linux required):
- `cargo test -p codex`
- `cargo test -p codex --examples`
- `CODEX_E2E_BINARY=./codex-x86_64-unknown-linux-musl cargo test -p codex --test cli_e2e -- --nocapture`
- Optional (requires valid auth under `CODEX_E2E_HOME`): `CODEX_E2E_LIVE=1 CODEX_E2E_BINARY=./codex-x86_64-unknown-linux-musl cargo test -p codex --test cli_e2e -- --nocapture`

## Done Criteria

- `cargo run -p xtask -- codex-validate --root cli_manifests/codex` passes.
- For the required target (`x86_64-unknown-linux-musl`), `cli_manifests/codex/reports/0.92.0/coverage.x86_64-unknown-linux-musl.json` has:
  - no missing/unknown/unsupported surfaces after regeneration, OR all remaining gaps are explicitly `intentionally_unsupported` with rationale notes.
- If `snapshots/0.92.0/union.json.complete == true`, meet the same criterion for all expected targets.

## Work Queue Summary (autogenerated)

- Version: `0.92.0`
- Baseline: `0.61.0`
- Required target: `x86_64-unknown-linux-musl`
- Primary report: `cli_manifests/codex/reports/0.92.0/coverage.x86_64-unknown-linux-musl.json`

### Counts (required target)

- missing_commands: 12
- missing_flags: 144
- missing_args: 17
- unsupported: 0
- intentionally_unsupported (audit-only): 59
- excluded_commands/flags/args (audit-only): 0/3/3

### New/Removed Commands vs Baseline

- Only in baseline (`0.61.0`):
  - mcp add
  - mcp get
  - mcp list
  - mcp login
  - mcp logout
  - mcp remove
- Only in new (`0.92.0`):
  - cloud apply
  - cloud diff
  - cloud list
  - cloud status
  - exec review
  - fork
  - review

### First Missing Commands

- app-server help
- exec help
- exec review
- features
- features help
- fork
- help
- login help
- resume
- review
- sandbox
- sandbox help

### First Missing Flags

- [app-server] --analytics-default-enabled
- [app-server] --config
- [app-server] --disable
- [app-server] --enable
- [app-server] --help
- [app-server generate-json-schema] --config
- [app-server generate-json-schema] --disable
- [app-server generate-json-schema] --enable
- [app-server generate-json-schema] --help
- [app-server generate-ts] --config
- [app-server generate-ts] --disable
- [app-server generate-ts] --enable
- [app-server generate-ts] --help
- [apply] --config
- [apply] --disable
- [apply] --enable
- [apply] --help
- [exec] --add-dir
- [exec] --cd
- [exec] --config
- [exec] --dangerously-bypass-approvals-and-sandbox
- [exec] --disable
- [exec] --enable
- [exec] --full-auto
- [exec] --help
- [exec] --image
- [exec] --local-provider
- [exec] --model
- [exec] --oss
- [exec] --profile
- [exec] --sandbox
- [exec] --version
- [exec resume] --config
- [exec resume] --dangerously-bypass-approvals-and-sandbox
- [exec resume] --disable
- [exec resume] --enable
- [exec resume] --full-auto
- [exec resume] --help
- [exec resume] --image
- [exec resume] --model

### First Missing Args

- [app-server] COMMAND
- [app-server help] COMMAND
- [exec] COMMAND
- [exec help] COMMAND
- [exec review] PROMPT
- [features] COMMAND
- [features help] COMMAND
- [fork] PROMPT
- [fork] SESSION_ID
- [help] COMMAND
- [login] COMMAND
- [login help] COMMAND
- [resume] PROMPT
- [resume] SESSION_ID
- [review] PROMPT
- [sandbox] COMMAND
- [sandbox help] COMMAND

Next: open `cli_manifests/codex/reports/0.92.0/coverage.x86_64-unknown-linux-musl.json` and work missing_commands → missing_flags → missing_args.

